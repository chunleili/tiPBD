```
cmake -B build -DCMAKE_BUILD_TYPE=Release
cmake --build build --config Release
```

- Linux 得到 `build/libfast-vcycle-gpu.so`。
- Windows 得到 `build/Release/fast-vcycle-gpu.dll`。



# Notes about generating dlls
1. Install CUDA 12.5, VS2022
2. Change set(CMAKE_CUDA_ARCHITECTURES 89) in CMakeLists.txt
3. Run cmake from cmd(Not powershell! Powershell does not work for `set(CMAKE_CUDA_ARCHITECTURES 89).`)
4. We need 7 dlls in `cpp\mgcg_cuda\lib`:
   1. cublas64_12.dll
   2. cublasLt64_12.dll
   3. cusparse64_12.dll
   4. nvJitLink_120_0.dll
   5. fast-vcycle-gpu.dll
   6. fast-vcycle-gpu.exp
   7. fast-vcycle-gpu.lib
   
First 4 files are from `C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v12.5\bin`. They are used by cublas and cusparse. The last 3 files are our own dlls. They are generated by cmake.

Extra Notes: 
  - Either copy the four cuda dlls to `cpp\mgcg_cuda\lib` or use `os.add_dll_directory("C:/Program Files/NVIDIA GPU Computing Toolkit/CUDA/v12.5/bin")`.

  - In Windows, use dumpbin /dependents to check the dependencies of a dll. For example, `dumpbin /dependents fast-vcycle-gpu.dll` will show the dependencies of fast-vcycle-gpu.dll.


Download(600MB): 
https://bhpan.buaa.edu.cn/link/AA1B784714F4D846E59851D1B12E83196D
or
https://www.dropbox.com/scl/fi/tvpr3g3btjca0maaz6gfl/dlls.zip?rlkey=68u687oghe5i7tddvedggcy7l&st=eo8dg8cd&dl=0


# download external libraries
## eigen

```
git clone https://gitlab.com/libeigen/eigen.git --depth 1
```
## pybind11
```
git clone https://github.com/pybind/pybind11.git --depth=1
```

You must has the same version of python as the one used to build pybind11
```
conda activate py310
```

# misc
## Remove build files in powershell
```
Remove-Item .\build\* -Recurse
```

## other 
Run from "x64 Native Tools Command Prompt for VS 2022"

nvcc -I"C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v12.2/include" -I"." spgemm.cu -o spgemm -lcusparse